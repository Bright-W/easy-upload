// ==UserScript==
// @name         easy-seed
// @namespace    https://github.com/techmovie/easy-seed
// @version      1.0.0-beta.0
// @description  easy seeding for different trackers
// @author       techmovie <v.abed@icloud.com>
// @require      https://cdn.bootcss.com/jquery/1.7.1/jquery.min.js
// @match        https://passthepopcorn.me/torrents.php?id=*
// @match        https://hdbits.org/offer.php
// @match        https://*/details.php?id=*
// @match        https://totheglory.im/t/*
// @match        https://beyond-hd.me/torrents/*
// @match        https://lemonhd.org/details*
// @match        http*://*/upload*
// @grant        GM_addStyle
// @grant        GM_xmlhttpRequest
// ==/UserScript==
(()=>{var B={HDBits:{url:"https://hdbits.org",host:"hdbits.org",siteType:"HDB",asSource:!0,asTarget:!0,needDoubanInfo:!0,uploadPath:"/upload.php",seedDomSelector:"#details >tbody >tr:contains(Last seeded)",searchPath:"/browse.php",searchKey:"search",searchParam:{sort:"size",d:"DESC"},name:{selector:"#name"},description:{selector:"#descr"},imdb:{selector:"#imdb"},mediaInfo:{selector:'textarea[name="techinfo"]'},category:{selector:"#type_category",map:{movie:"1",tv:"2",documentary:"3",concert:"4",sport:"5"}},videoCodec:{selector:"#type_codec",map:{h264:"1",h265:"5",hevc:"5",x264:"1",x265:"5",mpeg2:"2",vc1:"3",xvid:"4",bluray:"1",uhdbluray:"5",vp9:"6"}},videoType:{selector:"#type_medium",map:{uhdbluray:"1",bluray:"1",remux:"5",encode:"3",web:"6",hdtv:"4"}}},MTeam:{url:"https://pt.m-team.cc",host:"pt.m-team.cc",siteType:"NexusPHP",asSource:!0,asTarget:!0,uploadPath:"/upload.php",seedDomSelector:"#top+table tr:nth-child(7)",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#descr"},imdb:{selector:'input[name="url"][type="text"]'},category:{selector:"#browsecat",map:{movie:["401","419","420","421","439"],tv:["403","402","435","402","439","435","438"],documentary:"404",concert:"406",sport:"407"}},videoCodec:{selector:'select[name="codec_sel"]',map:{h264:"1",hevc:"16",h265:"16",x264:"1",x265:"16",mpeg2:"4",mpeg4:"15",vc1:"2",xvid:"3"}},videoType:{map:{bluray:["421","438"],remux:["439"],encode:["401","419","403","402"],web:["419","402"],hdtv:["419","402"],dvd:["420","435"],dvdrip:["401","403"],other:""}},resolution:{selector:'select[name="standard_sel"]',map:{"2160p":["6","419","402"],"1080p":["1","419","402"],"1080i":["2","419","402"],"720p":["3","419","402"],"576p":["5","401","403"],"480p":["5","401","403"]}},area:{selector:'select[name="processing_sel"]',map:{CN:"1",US:"2",EU:"2",HK:"3",TW:"3",JP:"4",KR:"5",OT:"6"}}},CHDBits:{url:"https://chdbits.co",host:"chdbits.co",siteType:"NexusPHP",asSource:!0,asTarget:!0,seedDomSelector:"#top+table tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:'textarea[name="descr"]'},imdb:{selector:'input[name="url"][type="text"]'},category:{selector:"#browsecat",map:{movie:"401",tv:"403",tvpack:"402",documentary:"404",cartoon:"405",sport:"407",concert:"406"}},videoCodec:{selector:'select[name="codec_sel"]',map:{h264:"1",hevc:"5",h265:"5",x264:"1",x265:"5",mpeg2:"4",mpeg4:"6",vc1:"2",xvid:"6"}},audioCodec:{selector:'select[name="audiocodec_sel"]',map:{aac:"6",ac3:"7",dd:"4","dd+":"7",flac:"1",dts:"3",truehd:"11",lpcm:"13",dtshdma:"10",atmos:"10",dtsx:"3"}},videoType:{selector:'select[name="medium_sel"]',map:{uhdbluray:["19"],bluray:["1"],remux:["3"],encode:["4"],web:["18"],hdtv:["6"]}},resolution:{selector:'select[name="standard_sel"]',map:{"2160p":["6"],"1080p":["1"],"1080i":["2"],"720p":["3"],"480p":["5"]}},area:{selector:'select[name="processing_sel"]',map:{CN:"8",US:"3",EU:"7",HK:"5",TW:"9",JP:"4",KR:"6",OT:"0"}}},TTG:{url:"https://totheglory.im",host:"totheglory.im",siteType:"TTG",asSource:!0,asTarget:!0,seedDomSelector:"#main_table h1+table>tbody>tr:nth-child(2)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search_field",searchParam:{sort:"5",type:"desc"},name:{selector:'input[name="name"]'},description:{selector:'textarea[name="descr"]'},imdb:{selector:'input[name="imdb_c"]'},category:{selector:'select[name="type"]',map:{movie:["51","52","53","54","108","109"],moviePack:[],tv:["69","70","73","74","75","76","87","88","99","90"],tvPack:[],documentary:["62","63","67"],concert:"59",sport:"57",cartoon:"58",variety:["103","60","101"]}},videoType:{map:{uhdbluray:["109"],bluray:["54","109","67"],remux:["53","108","63","70","75"],encode:["53","63","70","75","52","62","69","76","108"],web:["53","63","70","75","52","62","69","76","108"],hdtv:["53","63","70","75","52","62","69","76","108"],dvd:["51"],dvdrip:["51"],other:""}},resolution:{map:{"2160p":["108","109","67"],"1080p":["53","63","70","75","54","67"],"1080i":["53","63","70","75"],"720p":["52","62","69","76"],"576p":"","480p":""}},area:{map:{CN:["76","75","90"],US:["69","70","87"],EU:["69","70","87"],HK:["76","75","90"],TW:["76","75","90"],JP:["73","88","101"],KR:["74","99","103"],OT:""}}},SSD:{url:"https://springsunday.net",host:"springsunday.net",siteType:"NexusPHP",asSource:!0,asTarget:!0,uploadPath:"/upload.new.php",searchPath:"/torrents.php",seedDomSelector:"#top+table tr:nth-child(3)",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:"#small_descr"},description:{selector:"#descr"},imdb:{selector:"#url"},mediaInfo:{selector:"#Media_BDInfo"},screenshots:{selector:"#url_vimages"},category:{selector:"#browsecat",map:{movie:"501",tv:"502",documentary:"503",concert:"507",sport:"506",cartoon:"504",variety:"505"}},videoCodec:{selector:'select[name="codec_sel"]',map:{h264:"2",hevc:"1",x264:"2",x265:"1",h265:"1",mpeg2:"4",mpeg4:"",vc1:"3",xvid:"",dvd:""}},audioCodec:{selector:'select[name="audiocodec_sel"]',map:{aac:"5",ac3:"4",dd:"4","dd+":"4",flac:"7",dts:"3",truehd:"2",lpcm:"6",dtshdma:"1",atmos:"3",dtsx:"3"}},videoType:{selector:'select[name="medium_sel"]',map:{uhdbluray:"1",bluray:"1",remux:"4",encode:"6",web:"7",hdtv:"5",dvd:"3",dvdrip:"10",other:""}},resolution:{selector:'select[name="standard_sel"]',map:{"2160p":"1","1080p":"2","1080i":"3","720p":"4","576p":"5","480p":"5"}},area:{selector:'select[name="source_sel"]',map:{CN:"1",US:"9",EU:"9",HK:"2",TW:"2",JP:"10",KR:"10",OT:"3"}}},HDHome:{url:"https://hdhome.org",host:"hdhome.org",siteType:"NexusPHP",asSource:!0,asTarget:!0,uploadPath:"/upload.php",searchPath:"/torrents.php",seedDomSelector:"#top+font>table:nth-child(1)>tbody>tr:nth-child(3)",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#descr"},imdb:{selector:'input[name="url"][type="text"]'},douban:{selector:'input[name="douban_id"]'},category:{selector:"#browsecat",map:{movie:["411","412","413","414","415","450","499","416"],moviePack:"",tv:["425","426","471","427","428","429","430","452","431"],tvPack:["432","433","434","435","436","437","438","502"],documentary:["417","418","419","420","421","451","500","422"],concert:"441",sport:["442","443"],cartoon:["444","445","446","447","448","454","449","501"],variety:[]}},videoCodec:{selector:'select[name="codec_sel"]',map:{h264:"1",hevc:"12",x264:"1",x265:"2",h265:"2",mpeg2:"4",mpeg4:["5","412","418","426","433","445"],vc1:"3",xvid:"5",dvd:"5"}},source:{selector:'select[name="source_sel"]',map:{uhdbluray:"9",bluray:"1",hdtv:"4",dvd:"3",web:"7",vhs:"8",hddvd:"8"}},audioCodec:{selector:'select[name="audiocodec_sel"]',map:{aac:"6",ac3:"15",dd:"15","dd+":"15",dts:"3",truehd:"13",lpcm:"14",dtshdma:"11",atmos:"12",dtsx:"17"}},videoType:{selector:'select[name="medium_sel"]',map:{uhdbluray:["10","499","500","502","501"],bluray:["1","450","451","452","453","454"],remux:["3","415","421","430","437","448"],encode:["7","411","412","413","414","416","417","418","419","420","422","425","426","471","427","428","429","431","432","433","434","435","436","438","444","445","446","447","449"],web:["11","411","412","413","414","416","417","418","419","420","422","425","426","471","427","429","431","432","433","434","436","438","444","445","446","447","449"],hdtv:["5","412","413","416","418","419","422","424","426","471","427","428","431","433","434","435","438","442","443","445","446","449"],dvd:["","411","417","425","432","444"],dvdrip:["7","411","417","425","432","444"],other:""}},resolution:{selector:'select[name="standard_sel"]',map:{"2160p":["1","499","416","500","422","431","438","502","449","501"],"1080p":["2","414","420","429","436","447"],"1080i":["3","424","428","435","443"],"720p":["4","413","419","423","427","434","442","446"],"576p":["5","411","417","425","432","444"],"480p":["5","411","417","425","432","444"]}}},OurBits:{url:"https://ourbits.club",host:"ourbits.club",siteType:"NexusPHP",asSource:!0,asTarget:!0,seedDomSelector:"#top+table tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:'input[name="name"]'},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#body"},douban:{selector:"dburl"},imdb:{selector:'input[name="url"]'},mediaInfo:{selector:"#Media_BDInfo"},screenshots:{selector:"#url_vimages"},category:{selector:'select[name="type"]',map:{movie:"401",tv:"412",tvpack:"405",documentary:"410",concert:"419",sport:"415",cartoon:"411",variety:"413"}},videoCodec:{selector:'select[name="codec_sel"]',map:{h264:"12",hevc:"14",x264:"12",x265:"14",h265:"14",mpeg2:"15",mpeg4:"12",vc1:"16",xvid:"17",dvd:"18"}},audioCodec:{selector:'select[name="audiocodec_sel"]',map:{aac:"7",ac3:"6",dd:"6","dd+":"6",flac:"13",dts:"4",truehd:"2",lpcm:"5",dtshdma:"1",atmos:"14",dtsx:"21"}},videoType:{selector:'select[name="medium_sel"]',map:{uhdbluray:"12",bluray:"1",remux:"4",encode:"7",web:"9",hdtv:"5",dvd:"2",dvdrip:"2",other:"0"}},resolution:{selector:'select[name="standard_sel"]',map:{"2160p":"5","1080p":"1","1080i":"2","720p":"3","576p":"4","480p":"4"}},area:{selector:'select[name="processing_sel"]',map:{CN:"1",US:"2",EU:"2",HK:"3",TW:"3",JP:"4",KR:"5",OT:"6"}}},HDSky:{url:"https://hdsky.me",host:"hdsky.me",siteType:"NexusPHP",asSource:!0,asTarget:!1,seedDomSelector:"#top+table tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"}},HDChina:{url:"https://hdchina.org",host:"hdchina.org",siteType:"NexusPHP",asSource:!0,asTarget:!0,seedDomSelector:".table_details>tbody>tr:nth-child(1)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#descr"},imdb:{selector:'input[name="url"][type="text"]'},douban:{selector:'input[name="douban_id"]'},category:{selector:"#browsecat",map:{movie:["20","17","16","9","410","27"],tv:["13","25","26","24","27"],tvPack:["20","21","22","23","27"],documentary:["20","5","27"],concert:"402",sport:"15",cartoon:"14",variety:"401"}},videoCodec:{selector:'select[name="codec_sel"]',map:{h264:"1",hevc:"10",x264:"6",x265:"10",h265:"10",mpeg2:"4",mpeg4:["1","27"],vc1:"2",xvid:"3",dvd:"4"}},audioCodec:{selector:'select[name="audiocodec_sel"]',map:{aac:"6",ac3:"8",dd:"8","dd+":"8",dts:"3",truehd:"13",lpcm:"11",dtshdma:"12",atmos:"15",dtsx:"14",flac:"1"}},videoType:{selector:'select[name="medium_sel"]',map:{uhdbluray:["11","20","410"],bluray:["11","20"],remux:"6",encode:"5",web:"21",hdtv:"13",dvd:"14",dvdrip:"4",other:"15"}},resolution:{selector:'select[name="standard_sel"]',map:{"2160p":["17","13","25","26","24","21","22","23","410"],"1080p":["11","17","13","25","26","24","21","22","23"],"1080i":["12","16","13","25","26","24","21","22","23"],"720p":["13","9","13","25","26","24","21","22","23"],"576p":"15","480p":"15"}},area:{map:{CN:["25","22"],US:["13","21"],EU:["13","21"],HK:["25","22"],TW:["25","22"],JP:["24","23"],KR:["26","23"]}}},KEEPFRDS:{url:"https://pt.keepfrds.com",host:"pt.keepfrds.com",siteType:"NexusPHP",asSource:!0,asTarget:!1,seedDomSelector:"#top+table tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"}},PTSBAO:{url:"https://ptsbao.club",host:"ptsbao.club",siteType:"NexusPHP",asSource:!0,asTarget:!0,seedDomSelector:"#top+font+table tr:nth-child(5)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"}},BeiTai:{url:"https://www.beitai.pt",host:"www.beitai.pt",siteType:"NexusPHP",asSource:!0,asTarget:!1,seedDomSelector:"#top+table>tbody>tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"}},PTHome:{url:"https://pthome.net",host:"pthome.net",siteType:"NexusPHP",asSource:!0,asTarget:!1,seedDomSelector:"#top+table>tbody>tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"}},LEMONHD:{url:"https://lemonhd.org",host:"lemonhd.org",siteType:"NexusPHP",asSource:!0,asTarget:!1,seedDomSelector:"#top+div+table>tbody>tr:nth-child(3)",uploadPath:"/upload.php",searchPath:"/browse.php",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"}},PTP:{url:"https://passthepopcorn.me",host:"passthepopcorn.me",siteType:"gazelle",asSource:!0,asTarget:!1,needDoubanInfo:!0,uploadPath:"/upload.php",searchPath:"/torrents.php",searchKey:"search",searchParam:{action:"advanced"},seedDomSelector:""},BeyondHD:{url:"https://beyond-hd.me",host:"beyond-hd.me",siteType:"F3NIX",asSource:!0,asTarget:!0,seedDomSelector:".table-details tr:last",needDoubanInfo:!0,uploadPath:"/upload",searchPath:"/torrents/all",searchKey:"imdb",searchParam:{doSearch:"Search",sorting:"size",direction:"desc"},name:{selector:"#title"},description:{selector:"#upload-form-description"},imdb:{selector:"#imdbauto"},tmdb:{selector:"#tmdbauto"},mediaInfo:{selector:"#mediainfo"},videoType:{selector:"#category_id",map:{movie:"1",tv:"2"}},category:{selector:"#autotype",map:{BD100:"UHD 100",BD66:"UHD 66",UHD50:"UHD 50",BD50:"BD 50",BD25:"BD 25",remux:["UHD Remux","BD Remux","DVD Remux"],encode:["2160p","1080p","720p","576p","540p","480p"],web:["2160p","1080p","720p","576p","540p","480p"],hdtv:["2160p","1080p","1080i","720p"],dvd:["DVD 9","DVD 5","DVD Remux"],dvdrip:["480p"],other:""}},source:{selector:"#autosource",map:{uhdbluray:["Blu-ray"],bluray:["Blu-ray","BD 50","BD 25","BD Remux","UHD 100","UHD 66","UHD 50","UHD Remux","2160p","1080p","720p","576p","540p","480p"],hdtv:["HDTV","2160p","1080p","1080i","720p"],dvd:["DVD","DVD 9","DVD 5","DVD Remux","480p"],web:["WEB","2160p","1080p","720p","576p","540p","480p"],hddvd:"HD-DVD"}},resolution:{map:{"2160p":["UHD 100","UHD 66","UHD 50","UHD Remux","2160p"],"1080p":["BD 50","BD 25","BD Remux","1080p"],"1080i":["BD 50","BD 25","BD Remux","1080i"],"720p":["720p"],"576p":["576p"],"540p":["540p"],"480p":["DVD 9","DVD 5","DVD Remux","480p"],other:["Other"]}}},PTer:{url:"https://pterclub.com",host:"pterclub.com",siteType:"NexusPHP",asSource:!0,asTarget:!0,uploadPath:"/upload.php",searchPath:"/torrents.php",seedDomSelector:"#top+table>tbody>tr:nth-child(3)",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#descr"},imdb:{selector:'input[name="url"]'},douban:{selector:'input[name="douban"]'},category:{selector:"#browsecat",map:{movie:"401",moviePack:"401",tv:"404",tvPack:"404",documentary:"402",concert:"406",sport:"407",cartoon:"403",variety:"405"}},videoType:{selector:'select[name="source_sel"]',map:{uhdbluray:"1",bluray:"2",remux:"3",encode:"6",web:"5",hdtv:"4",dvd:"7",dvdrip:"7",other:"15"}},area:{selector:'select[name="team_sel"]',map:{CN:"1",US:"4",EU:"4",HK:"2",TW:"3",JP:"6",KR:"5",IND:"7",OT:"8"}}},HD4FANS:{url:"https://pt.hd4fans.org",host:"pt.hd4fans.org",siteType:"NexusPHP",asSource:!0,asTarget:!0,uploadPath:"/upload.php",searchPath:"/torrents.php",seedDomSelector:"#top+table>tbody>tr:nth-child(3)",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},name:{selector:"#name"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#descr"},imdb:{selector:'input[name="url"]'},douban:{selector:'input[name="douban"]'},category:{selector:"#browsecat",map:{movie:"401",moviePack:"401",tv:"404",tvPack:"404",documentary:"402",concert:"406",sport:"407",cartoon:"403",variety:"405"}},videoType:{selector:'select[name="source_sel"]',map:{uhdbluray:"1",bluray:"2",remux:"3",encode:"6",web:"5",hdtv:"4",dvd:"7",dvdrip:"7",other:"15"}},area:{selector:'select[name="team_sel"]',map:{CN:"1",US:"4",EU:"4",HK:"2",TW:"3",JP:"6",KR:"5",IND:"7",OT:"8"}}},TJUPT:{url:"https://www.tjupt.org",host:"www.tjupt.org",siteType:"NexusPHP",asSource:!0,asTarget:!0,uploadPath:"/upload.php",searchPath:"/torrents.php",seedDomSelector:"#top+table>tbody>tr:nth-child(5)",searchKey:"search",searchParam:{search_area:"{key}",sort:"5",type:"desc"},subtitle:{selector:'input[name="small_descr"]'},description:{selector:"#descr"},imdb:{selector:'input[name="url"]'},douban:{selector:"#external_url"},category:{selector:"#browsecat",map:{movie:"401",moviePack:"401",tv:"402",tvPack:"402",documentary:"411",concert:"406",sport:"407",cartoon:"405",variety:"403"}}}};var o={title:"",subtitle:"",description:"",year:"",category:"",videoType:"",source:"",videoCodec:"",audioCodec:"",resolution:"",area:"",doubanUrl:"",doubanInfo:"",imdbUrl:"",tags:{DIY:!1,chineseAudio:!1,cantoneseAudio:!1,chineseSubtitle:!1,atoms:!1,dtsx:!1,HDR:!1,DolbyVision:!1},mediaInfo:"",bdinfo:"",screenshots:[],movieAkaName:"",movieName:"",sourceSite:"",size:""},j={HDB:"https://hdbits.org/browse.php?search={imdbid}&sort=size&h=8&d=DESC",PTP:"https://passthepopcorn.me/torrents.php?action=advanced&searchstr={imdbid}",MTeam:"https://pt.m-team.cc/torrents.php?incldead=0&spstate=0&inclbookmarked=0&search={imdbid}&search_area={searchArea}&search_mode=0",TTG:"https://totheglory.im/browse.php?search_field={imdbid}&c=M&sort=5&type=desc",CHD:"https://chdbits.co/torrents.php?incldead=0&spstate=0&inclbookmarked=0&search={imdbid}&search_area=4&search_mode=0",BHD:"https://beyond-hd.me/torrents/all?doSearch=Search&imdb={imdbid}&sorting=size&direction=desc",BLU:"https://blutopia.xyz/torrents?imdb={imdbid}",SSD:"https://springsunday.net/torrents.php?incldead=0&spstate=0&inclbookmarked=0&search={imdbid}&search_area={searchArea}&search_mode=0"},X="054022eaeae0b00e0fc068c0c0a2102a",Z="https://frodo.douban.com/api/v2",ee="https://omit.mkrobot.org/movie/infos",te="https://media.pttool.workers.dev",oe="https://api.themoviedb.org",re="3d62cb1443c6b34b61262ab332aaf78c",Te=e=>{let t="";try{return Object.keys(B).forEach(r=>{let s=B[r].host;s&&e===s&&(t=r)}),t}catch(r){r.message!=="end loop"&&console.log(r)}},V=["atmos","dtshdma","aac","ac3","dd+","dd","DolbyDigital","dtsx","dts","truehd","flac","lpcm"],ae=["Albania","Andorra","Armenia","Austria","Azerbaijan","Belarus","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Georgia","Germany","Greece","Hungary","Iceland","Ireland","Italy","Kazakhstan","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Moldova","Monaco","Montenegro","Netherlands","North Macedonia","Norway","Poland","Portugal","Romania","Russia","San Marino","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Turkey","Ukraine","United Kingdom","UK","Vatican City"],u=Te(location.host),f=B[u];var E=e=>e.replace(/(?<!(([^\d]+\d{1})|([^\w]+H)))(\.)/ig," ").replace(/\.(?!(\d+))/," ").trim(),F=e=>{let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),r=location.search.substr(1).match(t);return r?unescape(r[2]):""},N=e=>{if(!e)return"";let t="",r=e.replace(/:|-|\s/g,"").toLowerCase();for(let s=0;s<V.length;s++)if(r.includes(V[s])){t=V[s];break}return t},q=e=>(e=e.replace(/\.|-/g,""),e.match(/x264/i)?"x264":e.match(/h264|AVC/i)?"h264":e.match(/x265/i)?"x265":e.match(/hevc|h265/i)?"hevc":e.match(/vc-?1/i)?"vc1":e.match(/mpeg-?2/i)?"mpeg2":e.match(/mpeg-?4/i)?"mpeg4":""),L=e=>{let t=e.match(/(\[url=(http(s)*:\/{2}.+?(\.(png|jpg)))\])?\[img\](.*?\.(png|jpg|gif))\[\/img](\[url\])?/g);if(t&&t.length>0)return t=t.filter(r=>!r.match(/GDJT|douban|logo|(2019\/03\/28\/5c9cb8f8216d7\.png)|_front|(info_01\.png)|(screens\.png)|(04\/6b\/Ggp5ReQb_o)|(ce\/e7\/KCmGFMOB_o)/)),t.map(r=>{let s="";return r.match(/\[url=http(s)*:.+/)?s=r.match(/=(([^\]])+)/)?.[1]:s=r.match(/img\](([^[])+)/)?.[1],s})},O=e=>e.match(/(uhd|2160|4k).*(blu(-)?ray|remux)/i)?"uhdbluray":e.match(/blu(-)?ray|remux/i)?"bluray":e.match(/hdtv/i)?"hdtv":e.match(/web(-(rip|dl))+/i)?"web":e.match(/hddvd/i)?"hddvd":e.match(/dvd/i)?"dvd":e.match(/vhs/i)?"vhs":"other",ce=e=>{let t=e.trans_title.join("/"),{director:r=[]}=e,s=r.map(l=>se(l.name)),a=e.cast.slice(0,2).map(l=>se(l.name)),c=s.length>0?`|\u5BFC\u6F14: ${s.join(" ")}`:"",i=a.length>0?`|\u4E3B\u6F14:${a.join(" ")}`:"";return t+c+i},se=e=>e.replace(/\s+[A-Za-z\s]+/,""),w=e=>{let t=ae;if(e){if(e.match(/USA|Canada|CA|美国|加拿大/i))return"US";if(t.includes(e)||e.match(/欧|英|法|德|俄|意|苏联|EU/))return"EU";if(e.match(/Japan|日本|JP/i))return"JP";if(e.match(/Korea|韩国|KR/i))return"KR";if(e.match(/Taiwan|台湾|TW/i))return"TW";if(e.match(/Hong\s?Kong|香港|HK/i))return"HK";if(e.match(/CN|China|大陆|中|内地|Mainland/i))return"CN"}return"OT"},ie=e=>{let t=e/1e9;if(t<25)return"BD25";if(t<50)return"BD50";if(t<66)return"BD66";if(t<100)return"BD100"},ne=e=>new Promise((t,r)=>{GM_xmlhttpRequest({method:"GET",url:`${oe}/3/find/${e}?api_key=${re}&language=en&external_source=imdb_id`,onload(s){let a=JSON.parse(s.responseText);(s.status!==200||!a.movie_results||a.movie_results.length<1)&&r(new Error("\u8BF7\u6C42\u5931\u8D25")),t(a.movie_results[0].id)}})}),le=e=>{let t=/tt\d+/.exec(e);return t&&t[0]?t[0]:""},R=e=>e.match(/T/i)?parseFloat(e)*1024*1024*1024*1024||0:e.match(/G/i)?parseFloat(e)*1024*1024*1024||0:e.match(/M/i)?parseFloat(e)*1024*1024||0:e.match(/K/i)?parseFloat(e)*1024||0:"",A=e=>{if(!e)return!1;let t=e.split(/\n\s*\n/),[r,s]=t,a=t.filter(h=>h.startsWith("Video #2")),[c,...i]=t.filter(h=>h.startsWith("Audio")),l=t.filter(h=>h.startsWith("Text")),n=x("Complete name",r).replace(/\.avi|\.mkv|\.mp4|\.ts/i,""),m=R(x("File size",r)),{videoCodec:d,isHdr:p,isDV:g}=xe(s,r,a),{audioCodec:b,channelName:y,languageArray:v}=Ce(c,i),C=l.map(h=>x("Language",h)),T=de(b,y,v,C,p,g),D=De(s);return{fileName:n,fileSize:m,videoCodec:d,audioCodec:b,resolution:D,mediaTags:T}},x=(e,t)=>{let r=e.replace(/\s/,"\\s*").replace(/(\(|\))/g,"\\$1"),s=new RegExp(`${r}\\s*:\\s([^
]+)`,"i");return t.match(s)?t.match(s)[1]:""},De=e=>{let t=parseInt(x("Height",e).replace(/\s/g,"")),r=parseInt(x("Width",e).replace(/\s/g,"")),s=x("Scan type",e);return t>1080?"2160p":t>720&&s==="Progressive"?"1080p":t>720&&s!=="Progressive"?"1080i":t>576||r>1024?"720p":t>480||r===1024?"576p":r>=840||t===480?"480p":`${r}x${t}`},de=(e,t,r,s,a,c)=>{let i=r.includes("Chinese"),l=s.includes("Chinese"),n={};return i&&(n.chineseAudio=!0),r.includes("Cantonese")&&(n.cantoneseAudio=!0),l&&(n.chineseSubtitle=!0),a&&(n.HDR=!0),c&&(n.DolbyVision=!0),e.match(/dtsx|atmos/ig)&&(n[e]=!0),n},xe=(e,t,r)=>{let s=x("Format",t),a=x("Format",e),c=x("Format version",e),i=x("Codec ID",e),l=x("HDR format",e),n=r.length>0&&x("HDR format",r[0]).includes("Dolby Vision"),m=!!x("Encoding settings",e),d="";return s==="DVD Video"?d="DVD":s==="MPEG-4"?d="mpeg4":a==="MPEG Video"&&c==="Version 2"?d="mpeg2":i.match(/xvid/i)?d="xvid":a.match(/HEVC/i)&&!m?d="hevc":a.match(/HEVC/i)&&m?d="x265":a.match(/AVC/i)&&m?d="x264":a.match(/AVC/i)&&!m?d="h264":a.match(/VC-1/i)&&(d="vc1"),{videoCodec:d,isHdr:!!l,isDV:n}},Ce=(e,t=[])=>{let r=x("Format",e),s=x("Channel(s)",e),a=x("Commercial name",e),c=[e,...t].map(m=>x("Language",m)),i="",l="",n=parseInt(s);return n&&n>=6?i=`${n-1}.1`:i=`${n}.0`,r.match(/MLP FBA/i)&&a.match(/Dolby Atmos/i)?l="atmos":r.match(/MLP FBA/i)&&!a.match(/Dolby Atmos/i)?l="truehd":r.match(/AC-3/i)&&a.match(/Dolby Digital$/i)?l="dd":r.match(/AC-3/i)&&a.match(/Dolby Digital Plus/i)?l="dd+":r.match(/AC-3/i)?l="ac3":r.match(/DTS XLL X/i)?l="dtsx":r.match(/DTS/i)&&a.match(/DTS-HD Master Audio/i)?l="dtshdma":r.match(/DTS/i)?l="dts":r.match(/FLAC/i)?l="flac":r.match(/AAC/i)?l="aac":r.match(/LPCM/i)&&(l="lpcm"),{audioCodec:l,channelName:i,languageArray:c}},S=e=>{if(!e)return"";let t=e.split("Disc Title");t.length>2&&(e=t[1]);let r=e.match(/VIDEO:(\s|Codec|Bitrate|Description|Language|-)*((.|\n)*)AUDIO:/i),s=e.match(/AUDIO:(\s|Codec|Bitrate|Description|Language|-)*((.|\n)*)(SUBTITLE(S))*/i),a=e.match(/SUBTITLE(S)*:(\s|Codec|Bitrate|Description|Language|-)*((.|\n)+)(FILES:)*/i),c=e.match(/Disc\s*Size:\s*((\d|,| )+)bytes/)?.[1]?.replaceAll(",",""),i=!e.match(/PLAYLIST REPORT/i),l=J(r,2),[n="",m=""]=l,d=n.match(/2160/)?"hevc":"h264",p=!!n.match(/\/\s*HDR(\d)*\s*\//i),g=!!m.match(/\/\s*Dolby\s*Vision\s*/i),b=J(s,2),y=J(a,3),v=n.match(/\d{3,4}(p|i)/)?.[0],{audioCodec:C,channelName:T,languageArray:D}=Pe(b,i),h=y.map(_=>{let I=_.match(/(\w+)\s*\//)?.[1],H=_.match(/Graphics\s*(\w+)\s*(\d|\.)+\s*kbps/i)?.[1];return i?I:H}),P=de(C,T,D,h,p,g);return{fileSize:c,videoCodec:d,audioCodec:C,resolution:v,mediaTags:P}},J=(e,t)=>e?.[t]?.split(`
`).filter(r=>!r.match(/^\s+$/))??[],Pe=(e,t)=>{let r=e.sort((d,p)=>{let g=parseInt(d.match(/\/\s*(\d+)\s*kbps/i)?.[1]);return parseInt(p.match(/\/\s*(\d+)\s*kbps/i)?.[1])-g}),[s,a]=r,c=N(s),i=N(a),l=c,n=s.match(/\d\.\d/)?.[0];c==="lpcm"&&i==="dtshdma"&&(l=i,n=s.match(/\d\.\d/)?.[0]);let m=r.map(d=>{let p=d.match(/(\w+)\s*\//)?.[1],g=d.match(/Audio\s*(\w+)\s*\d+\s*kbps/)?.[1];return t?p:g});return{audioCodec:l,channelName:n,languageArray:m}},_e=({pre:e,post:t,tracker:r},s,a)=>{let c=typeof e!="undefined"&&e!==null,i=typeof t!="undefined"&&t!==null;c&&e.unshift(s),i&&t.push(a)},U=e=>{if(e)return me(e).replace(/\[\w+(=(\w|\d|#)+)*\]((.|\n)*?(\[\/\w+\])?)\[\/\w+\]/g,function(r,s,a,c){return c&&c.match(/温馨提示|PT站|网上搜集|本种子|商业盈利|带宽|寬帶|法律责任|Quote:|正版|商用/)||!c?"":r})},me=e=>{let t=[],r=[],s=[],a=_e.bind(null,{pre:r,post:s});switch(e.nodeType){case 1:{switch(e.tagName.toUpperCase()){case"UL":{a("[list]","[/list]");break}case"OL":{a("[list=1]","[/list]");break}case"LI":{a("[*]");break}case"B":{a("[b]","[/b]");break}case"U":{a("[u]","[/u]");break}case"I":{a("[i]","[/i]");break}case"DIV":{if(e.className==="codemain"){a(`
[quote]`,"[/quote]");break}a(`
`,`
`);break}case"P":{a(`
`,`
`);break}case"BR":{a(`
`);break}case"SPAN":{a(null,null);break}case"BLOCKQUOTE":case"TD":case"PRE":case"FIELDSET":{a("[quote]","[/quote]");break}case"IMG":{let d="",{src:p}=e,g=e.getAttribute("data-src")||e.getAttribute("data-echo");if(g)d=g.match(/(http(s)?:)?\/\//)?g:location.origin+"/"+g;else if(p&&!p.match(/ico_\w+.gif|jinzhuan/))d=p;else return"";return`[img]${d}[/img]`}case"FONT":{let{color:d}=e;d&&a(`[color=${d}]`,"[/color]");break}case"A":{let{href:d}=e;d&&d.length>0&&a(`[url=${d}]`,"[/url]");break}case"H1":{a('[b][size="7"]',`[/size][/b]
`);break}case"H2":{a('[b][size="6"]',`[/size][/b]
`);break}case"H3":{a('[b][size="5"]',`[/size][/b]
`);break}case"H4":{a('[b][size="4"]',`[/size][/b]
`);break}}let{textAlign:c,fontWeight:i,fontStyle:l,textDecoration:n,color:m}=e.style;if(c)switch(c.toUpperCase()){case"LEFT":{a("[left]","[/left]");break}case"RIGHT":{a("[right]","[/right]");break}case"CENTER":{a("[center]","[/center]");break}}(i==="bold"||~~i>=600)&&a("[b]","[/b]"),l==="italic"&&a("[i]","[/i]"),n==="underline"&&a("[u]","[/u]"),m&&m.trim()!==""&&a(`[color=${m}]`,"[/color]");break}case 3:return e.textContent.match(/引用|Quote|代码|代碼/)?"":e.textContent;default:return null}return e.childNodes.forEach((c,i)=>{let l=me(c);l&&t.push(l)}),r.concat(t).concat(s).join("")},z=e=>{let t={};return e.match(/diy/i)&&(t.DIY=!0),e.match(/国配|国语/i)&&(t.chineseAudio=!0),e.match(/粤/i)&&(t.cantoneseAudio=!0),e.match(/简|繁|中字/i)&&(t.chineseSubtitle=!0),e.match(/Criterion|CC标准/i)&&(t.CC=!0),t};var Se=e=>{let t=`[quote][size=4]source from [b][color=#1A73E8]${e.sourceSite}[/color][/b]. Many thanks to the original uploader![/size][/quote]

`,r=f,s=e.doubanInfo&&u!=="SSD"?`${e.doubanInfo}
`:"",a=e.logs?`eac3to logs:
[hide]${e.logs}[/hide]

`:"",c=u==="HDBits"&&e.videoType.match(/bluray/),i=e.bdinfo?`BDInfo:
[quote]${e.bdinfo}[/quote]

`:"",l=r.mediaInfo&&!c?"":`[quote]${e.mediaInfo}[/quote]
`,n=e.screenshots.map(d=>d.match(/\[url=.+\]/i)?d:`[img]${d}[/img]`),m=u==="SSD"?"":`Screenshots:
${n.join("")}`;return`${t}${s}${l}${a}${i}${m}`},he=e=>{console.log(e);let t=le(e.imdbUrl);if($(f.imdb.selector).val(e.imdbUrl),u==="HDBits"){let n=e.title.replace(/([^\d]+)\s+([12][90]\d{2})/,(m,d,p)=>`${e.movieName||e.movieAkaName} ${p}`);e.videoType==="remux"&&(n=n.replace(/\s+(bluray|blu-ray)/ig,"")),e.title=n}u==="SSD"&&(e.title=e.title.replace(/\s/ig,"."),$(f.imdb.selector).val(e.doubanUrl||e.imdbUrl),$(f.screenshots.selector).val(e.screenshots.join(`
`))),f.name&&$(f.name.selector).val(e.title),Ie(),["subtitle","douban","area","audioCodec"].forEach(n=>{let m=f[n];if(m&&m.selector){let d=e[n];n==="douban"?d=e.doubanUrl:(n==="area"||n==="audioCodec")&&(d=m.map[e[n]]),$(m.selector).val(d)}});let s=e.mediaInfo,a=Se(e);if(f.mediaInfo&&!(e.videoType.match(/bluray/ig)&&u==="HDBits")&&$(f.mediaInfo.selector).val(s),e.description&&f.siteType.match(/NexusPHP|TTG/)&&!u.match(/SSD/)&&(a=e.description),$(f.description.selector).val(a),u==="BeyondHD"){$(f.imdb.selector).val(t),ne(t).then(d=>{$(f.tmdb.selector).val(d)});let{category:n,videoType:m}=e;if(e.category=m,e.videoType=n,m.match(/bluray/)){let d=ie(e.size);m==="uhdbluray"&&d==="BD50"&&(d="uhd50"),e.category=d}}let c=f.category.map[e.category],i=["videoCodec","videoType","resolution","source","area"],l=[];Array.isArray(c)?(l=[...c],i.forEach(n=>{l=ue(f,e,n,l),l.length===1&&$(f.category.selector).val(l[0])})):[...i,"category"].forEach(n=>{ue(f,e,n,l)}),u.match(/HDHome/i)&&$(f.category.selector).change()},ue=(e,t,r,s)=>{console.log(r);let a=e[r]?e[r].map[t[r]]:void 0;return Array.isArray(a)&&s?(e[r].selector&&$(e[r].selector).val(a.shift()),s.length>1&&(s=s.filter(c=>a.includes(c)))):e[r]&&e[r].selector&&$(e[r].selector).val(a),s},Ie=()=>{u.match(/SSD|HDHome|CHDBits|PTer/)&&$(f.name.selector).attr("id","")};var pe=()=>{let e=F("torrentid");if(console.log(e),!e)return!1;o.sourceSite=u;let t=$(`#torrent_${e}`),r=$(".page__title").text().match(/(^|])([^\d[]+)/)[2].trim(),[s,a=""]=r.split(" AKA ");o.mediaInfo=`${t.find(".mediainfo.mediainfo--in-release-description").next("blockquote").text()}`,o.movieName=s,o.movieAkaName=a,o.imdbUrl=$("#imdb-title-link").attr("href")||"",o.year=$(".page__title").text().match(/\[(\d+)\]/)[2];let c=$(`#group_torrent_header_${e}`);o.category=$e(),o.category==="concert"&&(o.description=$("#synopsis").text());let i=c.find("#PermaLinkedTorrentToggler").text().replace(/ /g,"").split("/"),[l,n,m,...d]=i,p=d.includes("Remux");o.videoType=m==="WEB"?"web":Ae(n,p,l,m);let{logs:g,bdinfo:b}=we(t);o.logs=g;let y=o.videoType.match(/bluray/i),v=y?S:A,C=y?b:o.mediaInfo;o.bdinfo=y?"":b;let{videoCodec:T,audioCodec:D,fileName:h="",resolution:P,mediaTags:_}=v(C);o.videoCodec=T,o.audioCodec=D,o.resolution=P,o.tags=_;let I=h||c.data("releasename");I=E(I),o.title=I,o.source=Ee(m,l,P),o.size=c.find(".nobr span").attr("title").replace(/[^\d]/g,""),o.screenshots=Be(t);let H=[],M=$("#movieinfo div").text().match(/Country:\s+([^\n]+)/);return M&&M.length>0&&(H=M?.[1].replace(/(,)\s+/g,"$1").split(",")),o.area=w(H?.[0]),o},$e=()=>{let e={"Feature Film":"movie","Short Film":"movie","Stand-up Comedy":"other",Miniseries:"tv","Live Performance":"concert","Movie Collection":"movie"},t=$("#torrent-table .basic-movie-list__torrent-edition__main").eq(0).text();return e[t]},we=e=>{let t=e.find(".movie-page__torrent__panel blockquote"),r="",s="";for(let a=0;a<t.length;a++){let c=t[a].textContent;c.match(/eac3to/)&&(r+=`[quote]${c}[/quote]`),c.match(/Disc\s*Size/)&&(s+=c)}return{logs:r,bdinfo:s}},Be=()=>{let e=!1,t=[],r=$(".movie-page__torrent__panel"),s=r.find("a");for(let a=0;a<s.length;a++){let c=s[a].getAttribute("onclick");if(c&&c.includes("BBCode.ScreenshotComparisonToggleShow")){e=!0,t=JSON.parse(c.match(/\["http([^\]]*)\]/)[0]);break}}if(!e){let a=r.find(".bbcode__image");for(let c=0;c<a.length;c++)t.push(a[c].getAttribute("src"))}return t},Ee=(e,t,r)=>t.match(/BD100|BD66/i)||e.match(/Blu-ray/i)&&r.match(/2160P|4K/i)?"uhdbluray":e.replace(/-/g,"").toLowerCase(),Ae=(e,t,r,s)=>{let a="";return t?a="remux":r.match(/BD50|BD25/ig)?a="bluray":r.match(/BD66|BD100/ig)?a="uhdbluray":s.match(/DVD/ig)&&e.match(/MKV|AVI/ig)?a="dvdrip":r.match(/DVD5|DVD9/ig)&&e.match(/VOB|ISO/ig)?a="dvd":e.match(/MKV|MP4/i)&&(a="encode"),a};var fe=()=>{o.sourceSite=u;let{Category:e,Name:t,Source:r,Type:s,Size:a}=Ue();o.size=R(a),o.title=E(t);let c=$(".movie-heading a:last").text(),i=$(".movie-heading a:first").text();if(c)o.year=c;else{let D=o.title.match(/\s([12][90]\d{2})/);o.year=D?D[0]:""}let{category:l,countries:n,imdbUrl:m}=Ne();o.movieName=i;let d=e.toLowerCase().replace(/s/,"");o.category=l==="Animation"?"cartoon":d,o.source=ke(r,s),o.area=w(n),o.videoType=He(s);let p=o.videoType.match(/bluray/i),g=$("#stats-full code").text();o.mediaInfo=g;let b=p?S:A,{videoCodec:y,audioCodec:v,resolution:C,mediaTags:T}=b(g);return o.videoCodec=y,o.audioCodec=v,o.resolution=C,o.tags=T,o.imdbUrl=m,o.screenshots=Re(),o},Ue=()=>{let e={};return $(".dotborder").each((t,r)=>{let s=$(r).find("td:first").text(),a=$(r).find("td:last").text();e[s]=a.replace(/\n/g,"").trim()}),console.log(e),e},Ne=()=>{let e=$(".movie-details a"),t={};return e.each((r,s)=>{let a=$(s).attr("href").replace(/.+\?/g,"").split("=");if(a.length>1){let c=decodeURI(a[0]),i=a[1];c==="g[]"&&(c="category"),t[c]=i}else a[0].match(/tt\d+/)&&(t.imdbUrl=a[0])}),t},Re=()=>{let e=$(".panel-body a"),t=[];return e.each((r,s)=>{let a=$(s).attr("href"),c=$(s).find("img").attr("src");c&&c.match(/.+\.png/i)&&t.push(`[url=${a}][img]${c}[/img][/url]`)}),t},ke=(e,t)=>t.match(/BD100|BD66/i)||e.match(/Blu-ray/i)&&t.match(/UHD/i)?"uhdbluray":e.match(/WEB|WEB-DL/i)?"web":e.replace(/-/g,"").toLowerCase(),He=e=>(e=e.replace(/\s/g,""),e.match(/Remux/i)?"remux":e.match(/BD50|BD25/i)?"bluray":e.match(/UHD50|UHD66|UHD100/i)?"uhdbluray":e.match(/DVD5|DVD9/i)?"dvd":e.match(/\d{3,4}p/i)?"encode":e);var ge=()=>{let e=F("id");o.sourceSite=u;let t=$("#details tr").has("a:contains(Edit torrent)"),r=t.length>0?t.prev():$("#details tr").has(".js-tagcontent").prev(),{size:s,category:a,videoType:c}=Me(),i=$("h1").eq(0).text();o.title=E(i);let l=$(".contentlayout h1").length>0,n=l?$(".contentlayout h1"):$("#details .showlinks li").eq(1);if(l){let b=n.prop("lastChild").nodeValue.replace(/\s|\(|\)/g,""),y=n.find("a").text();if(o.movieName=y,b)o.year=b;else{let v=o.title.match(/\s([12][90]\d{2})/);o.year=v?v[0]:""}}o.imdbUrl=n.find("a").attr("href"),o.category=a,o.source=O(o.title),o.videoType=c;let m=o.videoType.match(/bluray/i),d=m?S:A,{logs:p,bdinfo:g}=Oe(r);if(o.logs=p,!m)o.bdinfo=g,Fe(e).then(b=>{if(b){o.mediaInfo=b;let{videoCodec:y,audioCodec:v,resolution:C,mediaTags:T}=d(o.mediaInfo);o.videoCodec=y,o.audioCodec=v,o.resolution=C,o.tags=T}});else{o.mediaInfo=g;let{videoCodec:b,audioCodec:y,resolution:v,mediaTags:C}=d(g);o.videoCodec=b,o.audioCodec=y,o.resolution=v,o.tags=C}o.size=s,o.screenshots=Le(r)},Me=()=>{let e={"Blu-ray/HD DVD":"bluray",Capture:"hdtv",Encode:"encode",Remux:"remux","WEB-DL":"web"},t=$("th:contains(Category)").next().text(),r=$("th:contains(Size)").eq(0).next().text(),s=t.split("("),a=s[0].trim().toLowerCase(),c=s[1].split(",")[0].toLowerCase().replace(/\./g,""),i=s[1].split(",")[1].replace(/\)/g,"").trim();return{size:R(r),category:a,videoCodec:c,videoType:e[i]}},Fe=e=>new Promise((t,r)=>{GM_xmlhttpRequest({method:"GET",url:`https://hdbits.org/details/mediainfo?id=${e}`,onload(s){let a=s.responseText;(s.status!==200||!a)&&r(new Error("\u8BF7\u6C42\u5931\u8D25")),t(a)}})}),Oe=e=>{let t=e.find(".sub").has("b:contains(Quote)").next().find("td"),r="",s="";for(let a=0;a<t.length;a++){let c=t[a].textContent;c.match(/eac3to/)&&(r+=`[quote]${c}[/quote]`),c.match(/Disc\s*Size/i)&&(s+=c)}return{logs:r,bdinfo:s}},Le=e=>{let t=e.find("a").has("img"),r=[];return t.each((s,a)=>{let c=$(a).attr("href"),i=$(a).find("img").attr("src");i&&i.match(/.+\.(png|jpg)/i)&&r.push(`[url=${c}][img]${i}[/img][/url]`)}),r};var be=()=>{o.sourceSite=u;let e=$("#main_table h1").eq(0).text(),t=e.match(/[^[]+/)?.[0];o.title=E(t),o.subtitle=e.replace(t,"").replace(/\[|\]/g,""),o.tags=z(o.subtitle);let r=W("\u7C7B\u578B").text(),{category:s,area:a,videoType:c}=Ke(r);o.area=a,o.videoType=ze(t,c);let i=o.title.match(/(18|19|20)\d{2}/g);o.year=i?i.pop():"",o.imdbUrl=W("IMDB").find("a").attr("href"),o.source=O(o.title);let l=W("\u5C3A\u5BF8").text().match(/\(((\d|,)+)\s*字节\)/i)?.[1];o.size=l.replaceAll(",","");let n=o.videoType.match(/bluray/i),m=n?S:A;window.onload=()=>{let d=$("#kt_d"),p=U(d[0]);o.description=p;let g=p.match(/https:\/\/(movie\.)?douban.com\/subject\/\d+/)?.[0];g&&(o.doubanUrl=g);let b=p.match(/(产\s+地|国\s+家)\s+(.+)/)?.[2];b&&(o.area=w(b)),s?o.category=s:o.category=Ge(p);let{logs:y,bdinfo:v,mediaInfo:C}=Ve(p);o.logs=y;let T=n?v:C;if(T){o.mediaInfo=T,o.bdinfo=n?"":v;let{videoCodec:D,audioCodec:h,resolution:P,mediaTags:_}=m(T);o.videoCodec=D,o.audioCodec=h,o.resolution=P,o.tags={...o.tags,..._}}else{let D=o.title.match(/\d{3,4}(p|i)/i)?.[0];if(!D&&D.match(/4k|uhd/i)&&(D="2160p"),o.resolution=D,o.audioCodec=N(o.title),p.match(/VIDEO(\.| )*CODEC/i)){let h=p.match(/VIDEO(\.| )*CODEC\.*:?\s*([^\s_:]+)?/i)?.[2];if(h)o.videoCodec=h.replace(/\.|-/g,"").toLowerCase();else{let{title:P}=o;o.videoCodec=q(P)}}if(p.match(/AUDIO\s*CODEC/i)){let h=p.match(/AUDIO\s*CODEC\.*:?\s*(.+)/i)?.[1];h&&(o.audioCodec=N(h))}}o.screenshots=qe(p),console.log(o)}},Ke=e=>{let t="",r="",s="";return e.match(/电影/)||e.match(/影视/)?t="movie":e.match(/剧包/)?t="tvPack":e.match(/剧/)?t="tv":e.match(/记录/)?t="documentary":e.match(/综艺/)?t="variety":e.match(/体育/)?t="sport":e.match(/演唱会/)?t="concert":e.match(/动漫/)&&(t="cartoon"),e.match(/韩/)?r="KR":e.match(/日/)?r="JP":e.match(/华/)?r="CN":e.match(/欧/)&&(r="US"),e.match(/UHD原盘/i)?s="uhdbluray":e.match(/bluray原盘/i)?s="bluray":e.match(/DVD/i)&&(s="dvd"),{category:t,area:r,videoType:s}},Ve=e=>{let t=e.match(/\[quote\](.|\n)+?\[\/quote\]/g),r="",s="",a="";for(let c=0;c<t.length;c++){let i=je(t[c]);i.match(/eac3to/)&&(r+=`[quote]${i}[/quote]`),i.match(/Disc\s?Size|\.mpls/i)&&(s+=i),i.match(/Unique ID/i)&&(a+=i)}return{logs:r,bdinfo:s,mediaInfo:a}},je=e=>e.replace(/\[(.+)\]?/g,"").replaceAll("\u200D",""),qe=e=>{if(e.match(/More\.Screens/i)){let t=e.match(/\.More\.Screens\[\/u\]\[\/color\]\n((.|\n)+\[\/(url|img)\])/)?.[1];return L(t)}else return L(e)},ze=(e,t)=>e.match(/HDTV/i)?"hdtv":e.match(/web(-)*(dl|rip)/i)?"web":e.match(/remux/i)?"remux":e.match(/dvdrip/i)?"dvdrip":e.match(/x264|x265/i)?"encode":t,W=e=>$(`#main_table td.heading:contains(${e})`).next(),Ge=e=>{let t="movie",{title:r,subtitle:s}=o;return r.match(/s0?\d{1,2}/i)||e.match(/集\s*数/)?r.match(/s0?\d{1,2}e0\d{1,2}/i)||s.match(/第[^\s]集/)?t="tv":t="tvPack":e.match(/动画/)?t="cartoon":e.match(/记录/)&&(t="documentary"),t};var ye=()=>{let e=$("#top").text().split(/\s{3,}/)?.[0]?.trim(),t=e.match(/(19|20)\d{2}/g),r=$("td.rowhead:contains('\u57FA\u672C\u4FE1\u606F'), td.rowhead:contains('\u57FA\u672C\u8CC7\u8A0A')").next().text().replace(/：/g,":"),s=$("td.rowhead:contains('\u526F\u6807\u9898'), td.rowhead:contains('\u526F\u6A19\u984C')").next().text(),a=$("#kimdb>a").attr("href"),c=U($("#kdescr")[0]);if(u==="TJUPT"&&(e=(e.match(/\[((\w|\.|\d|-)+)\]/g).filter(_=>_.match(/\.| /))?.[0]??"").replace(/\[|\]/g,"")),u==="PTer"&&(c=$("#descrcopyandpaster").val()),u==="HDChina"){let h=[];$("li:contains('\u57FA\u672C\u4FE1\u606F'):last").next("li").children("i").each(function(){h.push($(this).text().replace("\uFF1A",":"))}),r=h.join("\xA0\xA0\xA0"),s=$("#top").next("h3").text()}if(u==="OurBits"&&(a=$(".imdbnew2 a:first").attr("href"),o.doubanUrl=$("#doubaninfo .doubannew a").attr("href"),o.doubanUrl)){let h=U($(".doubannew2 .doubaninfo")?.[0]),P=`[img]${$("#doubaninfo .doubannew a img").attr("src")}[/img]
`;o.doubanInfo=P+h}if(u==="KEEPFRDS"&&([e,s]=[s,e],t=e.match(/(19|20)\d{2}/g)),u==="SSD"){o.doubanUrl=$(".douban_info a:contains('://movie.douban.com/subject/')").attr("href");let h=U($(".douban-info artical")?.[0]),P=$("div[data-group='douban']").find("img").attr("src")?`[img]${$("div[data-group='douban']").find("img").attr("src")}[/img]
`:"";if(o.doubanInfo=P+h,c===""||c===void 0){let _=U($(".torrent-extra-text-container .extra-text")?.[0]),I=$("#kposter").find("img").attr("src")?`[img]${$("#kposter").find("img").attr("src")}[/img]
`:"",H=$(".screenshot").find("img").attr("src")?`[img]${$(".screenshot").find("img").attr("src")}[/img]
`:"",M="[quote]"+U($("section[data-group='mediainfo']")?.[0])+"[/quote]";c=I+_+M+H}a=$(".douban_info a:contains('://www.imdb.com/title/')").attr("href")}u==="LEMONHD"&&(r+=$("td.rowhead:contains('\u8BE6\u7EC6\u4FE1\u606F')").next().text().replace(/：/g,":"),r.match(/分辨率:/)===null&&(r=r.replace("\u5206\u8FA8\u7387","\u5206\u8FA8\u7387:")));let{category:i,videoType:l,videoCodec:n,audioCodec:m,resolution:d,processing:p,size:g}=Je(r);o.sourceSite=u;let b=c.match(/https:\/\/(movie\.)?douban.com\/subject\/\d+/)?.[0];b&&(o.doubanUrl=b);let y=c.match(/http(s)?:\/\/www.imdb.com\/title\/tt\d+/)?.[0];if(y?o.imdbUrl=y:a&&(o.imdbUrl=a.match(/www.imdb.com\/title/)?a:""),!p||p.match(/raw/)){let h=c.match(/(产\s+地|国\s+家)\s+(.+)/)?.[2];h&&(o.area=w(h))}else o.area=w(p);o.year=t?t.pop():"",o.title=e,o.subtitle=s,o.doubanInfo&&(c=o.doubanInfo+=c),o.description=c,o.category=Qe(i||c),o.videoType=Ye(l||o.title),o.source=O(o.title),o.size=g?R(g):"",o.screenshots=L(c),o.tags=z(o.subtitle);let v=o.videoType.match(/bluray/i),{logs:C,bdinfo:T,mediaInfo:D}=We(c);if(o.logs=C,o.bdinfo=v?"":T,v&&T){o.mediaInfo=T;let{videoCodec:h,audioCodec:P,resolution:_,mediaTags:I}=S(T);o.videoCodec=h,o.audioCodec=P,o.resolution=_,o.tags={...o.tags,...I}}else{if(o.mediaInfo=D,u.match(/beitai/i)){if(c.match(/VIDEO\s*(\.)?CODEC/i)){let h=c.match(/VIDEO\s*(\.)?CODEC\.*:?\s*([^\s_,]+)?/i)?.[2];h&&(o.videoCodec=h.replace(/\.|-/g,"").toLowerCase())}}else o.videoCodec=q(n||o.title);o.resolution=Xe(d),o.audioCodec=N(m||o.title)}},Je=e=>{let t=k("\u7C7B\u578B|\u5206\u7C7B|\u985E\u5225",e),r=k("\u5A92\u4ECB|\u6765\u6E90|\u8D28\u91CF",e),s=k("\u7F16\u7801|\u7DE8\u78BC",e),a=k("\u97F3\u9891|\u97F3\u9891\u7F16\u7801",e),c=k("\u5206\u8FA8\u7387|\u683C\u5F0F|\u89E3\u6790\u5EA6",e),i=k("\u5904\u7406|\u8655\u7406|\u5730\u533A",e),l=k("\u5927\u5C0F",e);return console.log({category:t,videoType:r,videoCodec:s,audioCodec:a,resolution:c,processing:i,size:l}),{category:t,videoType:r,videoCodec:s,audioCodec:a,resolution:c,processing:i,size:l}},We=e=>{let t=e.match(/\[quote\](.|\n)+?\[\/quote\]/g)??[],r="",s="",a="";for(let c=0;c<t.length;c++){let i=Ze(t[c]);i.match(/eac3to/)&&(r+=`[quote]${i}[/quote]`),i.match(/Disc\s?Size|\.mpls/i)&&(s+=i),i.match(/Unique ID/i)&&(a+=i)}return{logs:r,bdinfo:s,mediaInfo:a}},Ze=e=>e.replace(/\[(.+)\]?/g,"").replaceAll("\u200D",""),k=(e,t)=>{let r=`(${e}):\\s?([^\u4E00-\u9FA5]+)?`;e.match(/大小/)&&(r=`(${e}):\\s?((\\d|\\.)+\\s+(G|M|T|K)(i)?B)`),u.match(/KEEPFRDS|TJUPT/)&&e.match(/类型/)&&(r=`(${e}):\\s?([^\\s]+)?`),u==="PTer"&&e.match(/类型|地区/)&&(r=`(${e}):\\s?([^\\s]+)?`);let s=new RegExp(r),a=t.match(s,"i")?.[2];if(a)return a.replace(/\s/g,"").trim().toLowerCase()},Ye=e=>e?(e=e.replace(/[.-]/g,"").toLowerCase(),e.match(/uhd|ultra/ig)?"uhdbluray":e.match(/remux/ig)?"remux":e.match(/blu/ig)?"bluray":e.match(/encode|x264|x265|bdrip/ig)?"encode":e.match(/web/ig)?"web":e.match(/hdtv/ig)?"hdtv":e.match(/dvdr/ig)?"dvdrip":e.match(/dvd/ig)?"dvd":""):"",Qe=e=>e?(e=e.replace(/[.-]/g,"").toLowerCase(),e.match(/movie|bd|ultra|电影/ig)?"movie":e.match(/tv|drama|剧集/ig)?"tv":e.match(/TVSeries/ig)?"tvPack":e.match(/综艺/ig)?"variety":e.match(/document|纪录|紀錄/ig)?"documentary":e.match(/sport|体育/ig)?"sport":e.match(/mv|演唱/ig)?"concert":e.match(/anim|动|画|漫/ig)?"cartoon":""):"",Xe=e=>(e=e===void 0?"":e.toLowerCase(),e.match(/4k|2160|UHD/ig)?"2160p":e.match(/1080p/ig)?"1080p":e.match(/1080i/ig)?"1080i":e.match(/720p/ig)?"720p":e.match(/sd/ig)?"480p":e);var K=pe;f.siteType==="NexusPHP"?K=ye:u==="BeyondHD"?K=fe:u==="HDBits"?K=ge:u==="TTG"&&(K=be);var ve=K;var Rt=GM_addStyle(`
.seed-dom h4{
  text-align: center;
  margin: 0;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 15px;
}
.site-list,.search-list{
  margin: 0;
  padding: 0;
  list-style: none;
  display: flex;
  justify-content: center;
  margin-bottom: 15px;
  flex-wrap: wrap;
}
.seed-dom li,.search-list li {
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 5px;
}
.seed-dom li:last-child span{
  display: none;
}
.search-list li:last-child span{
  display: none;
}
.seed-dom li a{
  font-weight: 600;
}
.upload-section,.douban-section{
  display: flex;
  justify-content: center;
  margin-bottom: 15px;
  align-items: center;
}
.upload-section .upload-status,.douban-section .douban-status{
  margin-left: 5px;
  font-size: 14px;
}
#img-transfer,#douban-info{
  line-height: 1;
  white-space: nowrap;
  cursor: pointer;
  background: #fff;
  border: 1px solid #dcdfe6;
  color: #606266;
  -webkit-appearance: none;
  text-align: center;
  box-sizing: border-box;
  outline: none;
  transition: .1s;
  font-weight: 500;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  padding: 8px 20px;
  font-size: 14px;
  border-radius: 4px;
  margin:0;
  margin-right: 5px;
}
#img-transfer:hover,#douban-info:hover {
  background: #fff;
  border-color: #409eff;
  color: #409eff
}
#img-transfer.is-disabled, #img-transfer.is-disabled:hover,#douban-info.is-disabled, #douban-info.is-disabled:hover {
  color: #c0c4cc;
  cursor: not-allowed;
  background-image: none;
  background-color: #fff;
  border-color: #ebeef5;
}
.upload-section #nsfw{
  margin-left: 0;
  position: static;
}
.upload-section label{
  padding-left: 0;
}
#kdescr img{
  max-width: 100%;
}
`);var et=e=>{let r=Object.keys(B).sort().map((i,l)=>{let{url:n,uploadPath:m}=B[i];return B[i].asTarget&&i!==u?`<li>
      <a href="javascript:void(0);" data-link="${n}${m}#torrentInfo=null">${i} </a>
      <span>|</span>
      </li>`:""}),s=Object.keys(j).map(i=>{let l=o.imdbUrl?/tt\d+/.exec(o.imdbUrl)[0]:"",n="",m=l||o.movieAkaName||o.movieName;return i==="TTG"&&l&&(m=m.replace("tt","imdb")),n=j[i].replace("{imdbid}",m),n=n.replace("{searchArea}",l?"4":"0"),`<li><a href="${n}" target="_blank">${i}</a> <span>|</span></li>`}),a=f.needDoubanInfo?`<h4>\u83B7\u53D6\u8C46\u74E3\u7B80\u4ECB</h4>
  <div class="douban-section">
    <button id="douban-info">\u5F00\u59CB\u83B7\u53D6</button>
    <div class="douban-status"></div>
  </div>`:"",c=`
  <div class="seed-dom movie-page__torrent__panel">
    <h4>\u4E00\u952E\u8F6C\u79CD \u{1F3AC}</h4>
    <ul class="site-list">
      ${r.join("")}
    </ul>
    ${a}
    <h4>\u8F6C\u7F29\u7565\u56FE \u23EB</h4>
    <div class="upload-section">
      <button id="img-transfer">\u5F00\u59CB\u8F6C\u6362</button>
      <div class="checkbox">
        <input type="checkbox" id="nsfw">
        <label for="nsfw">\u662F\u5426\u5305\u542BNSFW</label>
      </div>
      <div class="upload-status"></div>
    </div>
    <h4>\u5FEB\u901F\u68C0\u7D22 \u{1F50D}</h4>
    <ul class="search-list">
      ${s.join("")}
    </ul>
  </div>
  `;e.prepend(c)},tt=()=>{let e=$(".upload-section .upload-status"),t=o.screenshots;try{if(t.length<1)throw new Error("\u83B7\u53D6\u56FE\u7247\u5217\u8868\u5931\u8D25");t=t.join(`
`);let r=$("#nsfw").is(":checked"),s=encodeURI(`imgs=${t}&content_type=${r?1:0}&max_th_size=300`);e.text("\u8F6C\u6362\u4E2D..."),$("#img-transfer").attr("disabled",!0).addClass("is-disabled"),GM_xmlhttpRequest({url:"https://pixhost.to/remote/",method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:s,onload(a){$("#img-transfer").removeAttr("disabled").removeClass("is-disabled");let c=a.responseText.match(/(upload_results = )({.*})(;)/);if(!c)throw new Error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");let i=[];if(c&&c.length)i=JSON.parse(c[2]).images,i.length&&(o.screenshots=i.map(l=>`[url=${l.show_url}][img]${l.th_url}[/img][/url]`),e.text("\u8F6C\u6362\u6210\u529F\uFF01"));else throw new Error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}})}catch(r){$("#img-transfer").removeAttr("disabled").removeClass("is-disabled"),e.text(r.message)}},ot=()=>{let e=$(".page__title>a").attr("href");if(e&&e.match("movie.douban.com"))return o.doubanUrl=e,Y(),!1;if(o.imdbUrl){let t=/tt\d+/.exec(o.imdbUrl)[0];GM_xmlhttpRequest({method:"GET",url:`${ee}/${t}`,onload(r){let s=JSON.parse(r.responseText);s&&s.data&&(o.doubanUrl=`https://movie.douban.com/subject/${s.data.id}`,Y())}})}else GM_xmlhttpRequest({method:"GET",url:`${Z}/search/weixin?q=${o.movieName}&start=0&count=1&apiKey=${X}`,onload(t){let r=JSON.parse(t.responseText);r&&r.items&&r.items.length>0&&(o.doubanUrl=`https://movie.douban.com/subject/${r.items[0].id}`,Y())}})},Y=()=>{let{doubanUrl:e}=o,t=$(".douban-section .douban-status");try{if(e)t.text("\u83B7\u53D6\u4E2D..."),GM_xmlhttpRequest({method:"GET",url:`${te}?url=${e}`,onload(r){let s=JSON.parse(r.responseText);if(s&&s.success)o.doubanInfo=s.format,o.subtitle=ce(s),t.text("\u83B7\u53D6\u6210\u529F");else throw new Error("\u83B7\u53D6\u8C46\u74E3\u4FE1\u606F\u5931\u8D25")}});else throw new Error("\u65E0\u6CD5\u83B7\u53D6\u8C46\u74E3\u4FE1\u606F")}catch(r){t.text(r.message)}},Q=location.hash&&location.hash.match(/(^|#)torrentInfo=([^#]*)(#|$)/),G=Q&&Q.length>0?Q[2]:null;if(u&&(G&&f.asTarget&&(G=JSON.parse(decodeURIComponent(G)),he(G)),console.log("CURRENT_SITE_NAME"+u),f.asSource&&!location.pathname.match(/upload/ig))){ve(),console.log(o);let e=$(f.seedDomSelector);if(f.siteType==="NexusPHP"||u==="BHD"||u==="TTG"){let t=`<tr>
      <td class="rowhead nowrap">
      </td>
      <td class="rowfollow easy-seed-td"></td>
      </tr>`;e.after(t),e=$(".easy-seed-td")}if(u==="HDBits"){let t=`<tr>
      <td class="rowfollow easy-seed-td"></td>
      </tr>`;e.after(t),e=$(".easy-seed-td")}if(u==="PTP"){let t=F("torrentid");e=$(`#torrent_${t} >td`)}et(e),$(".site-list li>a").click(function(){let t=encodeURIComponent(JSON.stringify(o)),r=$(this).data("link");r=r.replace(/(#torrentInfo=)(.+)/,`$1${t}`),window.open(r)}),$("#img-transfer")&&$("#img-transfer").click(()=>{tt()}),$("#douban-info")&&$("#douban-info").click(()=>{ot()})}})();
